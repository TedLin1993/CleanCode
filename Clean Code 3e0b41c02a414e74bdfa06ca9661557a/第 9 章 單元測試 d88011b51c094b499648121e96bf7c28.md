# ç¬¬ 9 ç«  å–®å…ƒæ¸¬è©¦

# **TDD çš„ä¸‰å¤§æ³•å‰‡**

- **æ­¥é©Ÿ 1**ï¼šåœ¨æ’°å¯«ä¸€å€‹å–®å…ƒæ¸¬è©¦ (æ¸¬è©¦å¤±æ•—çš„å–®å…ƒæ¸¬è©¦) å‰ï¼Œä¸å¯ä»¥æ’°å¯«ä»»ä½•ç”¢å“æ¸¬è©¦ã€‚
- **æ­¥é©Ÿ 2**ï¼šåªæ’°å¯«å‰›å¥½ç„¡æ³•é€šéçš„å–®å…ƒæ¸¬è©¦ã€‚
- **æ­¥é©Ÿ 3**ï¼šåªæ’°å¯«å‰›å¥½èƒ½é€šéç•¶å‰æ¸¬è©¦å¤±æ•—çš„ç”¢å“ã€‚

> ä»¥ä¸Šä¸‰å€‹æ­¥é©Ÿå¯ä»¥å°‡æˆ‘å€‘é™åˆ¶åœ¨ä¸€å€‹ç´„ 30 ç§’çš„å¾ªç’°å…§ã€‚
> 

å¦å¤–ï¼Œé‚„æœ‰ä¸€é …æœ‰äº›äººèª¤è§£ TDD æ˜¯ä¸€å€‹éå¸¸è¤‡é›œçš„æ–¹æ³•ï¼Œå…¶å¯¦ TDD èªªç™½äº†åªæ˜¯ã€Œ**æ¸¬è©¦ç¨‹å¼å’Œç”¢å“ç¨‹å¼æ˜¯ä¸€èµ·è¢«æ’°å¯«çš„ï¼Œæ¸¬è©¦ç¨‹å¼æ¯”ç”¢å“ç¨‹å¼æ—©å¹¾ç§’é˜å¯«è€Œå·²ã€‚**ã€

å¦‚æœæƒ³çœ‹å¯¦éš›ç¯„ä¾‹çš„äººå¯ä»¥çœ‹çœ‹Â [ğŸ”— ç¬¬ä¸ƒç«  â€” éŒ¯èª¤è™•ç†](https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/error-handling-6132b22fe5c2)Â çš„å–®å…ƒï¼Œæ–‡ä¸­æœ‰ä¸€å€‹ç¯„ä¾‹æ˜¯*å¦‚ä½•åˆ©ç”¨ TDD æ’°å¯«ä¸€å€‹æ¸¬è©¦éŒ¯èª¤è™•ç†çš„å–®å…ƒç¨‹å¼èˆ‡ä¸»ç¨‹å¼*ã€‚

æˆ‘å€‘ä½¿ç”¨ TDD çš„æ–¹æ³•é–‹ç™¼è»Ÿé«”ï¼Œé•·æœŸä¸‹ä¾†æˆ‘å€‘å°‡æœƒç´¯ç©æ•¸ä»¥åƒè¨ˆçš„æ¸¬è©¦ç¨‹å¼ï¼Œæ•¸é‡è¶³ä»¥è·Ÿé–‹ç™¼è»Ÿé«”çš„ç¨‹å¼ç¢¼åŒ¹æ•µã€‚å¦‚æœä¸æ“…åŠ æ§ç®¡ï¼Œå°‡æœƒå¾’å¢ç„¡æ³•ç¶­è­·çš„ç¨‹å¼ç¢¼ã€‚

## **æ¸¬è©¦è·Ÿç”¢å“ä¸€æ¨£é‡è¦**

æƒ³åƒä¸€å€‹ä¼æœ¨å·¥åªå°ˆæ³¨æ–¼å¦‚ä½•æ¯”æ˜¨å¤©ç æ›´å¤šçš„æ¨¹æœ¨ï¼Œè€Œå¿½ç•¥ä¿é¤Šæ–§é ­ï¼Œéš¨è‘—ä¸€å¤©åˆä¸€å¤©çš„éå»ï¼Œæ–§é ­è¶Šä¾†è¶Šéˆï¼Œå„˜ç®¡ä¼æœ¨å·¥èŠ±è²»æ›´å¤šçš„æ™‚é–“èˆ‡æ›´å¤šçš„ç²¾åŠ›ä¼æœ¨ï¼Œä½†æ˜¯ç çš„æ•¸é‡åªæœƒè¶Šä¾†è¶Šå°‘ï¼Œæ•ˆç‡è¶Šä¾†è¶Šå·®ã€‚

å–®å…ƒæ¸¬è©¦å°±åƒæ˜¯é‚£æŠŠæ–§é ­ï¼Œå¦‚æœä¸å–„åŠ ç¶­è­·ï¼Œæ¸¬è©¦çš„æŠ€è¡“å‚µè¶Šå †è¶Šé«˜ï¼Œç›¸å°çš„ç”¢å“çš„å“è³ªä¹Ÿæœƒæ¼¸æ¼¸åœ°å´©è§£ã€‚æˆ‘å€‘åœ¨æ’°å¯«å–®å…ƒæ¸¬è©¦æ™‚ï¼Œå¿…é ˆç¢ºä¿æ¸¬è©¦èˆ‡ç”¢å“ä¸€æ¨£æ˜¯å¯ä»¥æ“´å……ã€å¯è®€çš„ã€‚

> Uncle Bob:ã€Œä»€éº¼æ˜¯ä¸€å€‹æ•´æ½”çš„æ¸¬è©¦ï¼Ÿä¸‰ä»¶äº‹ï¼Œå¯è®€æ€§ï¼Œå¯è®€æ€§ï¼Œé‚„æ˜¯å¯è®€æ€§ã€‚ã€
> 

# **ç‰¹å®šé ˜åŸŸçš„æ¸¬è©¦èªè¨€**

æˆ‘å€‘å¹³å¸¸åœ¨å¯«å–®å…ƒæ¸¬è©¦çš„æ™‚å€™ï¼Œç¶“å¸¸éœ€è¦åšå¾ˆå¤šçš„**å‰ç½®ä½œæ¥­**ï¼Œå¦‚ä¸‹æ–¹çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘æƒ³è¦æ¸¬è©¦ä¸€å€‹çˆ¬èŸ²æ‡‰ç”¨çš„å‡½å¼ï¼Œå°±å¾—å…ˆå¯«ä¸å°‘çš„ç¨‹å¼ç¢¼ã€‚ä½†æ˜¯ï¼Œ**å‰ç½®ä½œæ¥­å¤ªå¤šçš„è©±ï¼Œåè€Œä¸å®¹æ˜“å°ˆæ³¨åœ¨å–®å…ƒæ¸¬è©¦ä¸Š**ã€‚

```python
class CrawlerTest(unittest.TestCase):
    def test_get_weather_forecast(self):
        weather_forecast_uri = "https://www.cwb.gov.tw/V7/forecast/taiwan/Taipei_City.htm"
        html = requests.get(weather_forecast_uri)
        html.encoding = 'utf8'
        weather_page = BeautifulSoup(html.text, "html.parser")
        weather_section = weather_page.find(id="ContainerInOne")
        todoy_and_tomorrow_forecast_table = weather_section.find(class_="FcstBoxTable01")

        expected_time = get_weather_forecast_time(forecast_table)
        time_pattern = r'[\u4e00-\u9fa5] \d+/\d+ \d+:\d+~\d+/\d+ \d+:\d+'
        for time in expected_time:
            self.assertRegex(time, time_pattern)
            
        expected_temperature = get_weather_forecast_temperature(forecast_table)
        temperature_pattern = r'\d+ ~ \d+'
        for temperature in expected_temperature:
            self.assertRegex(temperature, temperature_pattern)
```

å› æ­¤ï¼Œæœ‰æ™‚å€™æˆ‘å€‘å¯ä»¥ä¸ä½¿ç”¨ä¸»ç¨‹å¼æä¾›çš„ APIï¼Œè€Œæ˜¯æ’°å¯«å–®å…ƒæ¸¬è©¦æ‰ç”¨å¾—åˆ°çš„ APIï¼Œä½œè€…ç¨±å®ƒç‚ºã€Œ**ç‰¹å®šé ˜åŸŸçš„æ¸¬è©¦èªè¨€**ã€ã€‚

æˆ‘å€‘å°‡å‰ç½®ä½œæ¥­åŒ…è£èµ·ä¾†ï¼Œæ¯”è¼ƒä¸Šä¸‹å…©å€‹ä¾‹å­ï¼Œä¸‹æ–¹çš„ä¾‹å­æ˜¯ä¸æ˜¯æ›´å®¹æ˜“ç­è§£æ¸¬è©¦åœ¨æè¿°ä»€éº¼ï¼Ÿ

```python
class CrawlerTest(unittest.TestCase):
    def test_get_weather_forecast(self):
        forecast_table = get_taipei_forecast_weather_page()

        expected_time = get_weather_forecast_time(forecast_table)
        time_pattern = r'[\u4e00-\u9fa5] \d+/\d+ \d+:\d+~\d+/\d+ \d+:\d+'
        for time in expected_time:
            self.assertRegex(time, time_pattern)

        expected_temperature = get_weather_forecast_temperature(forecast_table)
        temperature_pattern = r'\d+ ~ \d+'
        for temperature in expected_temperature:
            self.assertRegex(temperature, temperature_pattern)
```

# **ä¸€å€‹æ¸¬è©¦ä¸€å€‹æ¦‚å¿µ &Â ä¸€å€‹æ¸¬è©¦æ‡‰è©²å„˜å¯èƒ½æ¸›å°‘Assert**

åœ¨æ’°å¯«å–®å…ƒæ¸¬è©¦çš„å‡½å¼å¾Œï¼Œæƒ³æƒ³é‚„èƒ½å¤ å¦‚ä½•æ”¹é€²ï¼Œé‚„è¨˜å¾—Â [ğŸ”— ç¬¬ 3 ç«  â€” å‡½å¼](https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/functions-3663c2ca9c16)èªªçš„å—ï¼Ÿã€Œ**ä¸€å€‹å‡½å¼åªèƒ½åšä¸€ä»¶äº‹**ã€ï¼Œå–®å…ƒæ¸¬è©¦åŒæ¨£æ˜¯ä¸€å€‹å‡½å¼ã€‚å› æ­¤ï¼Œç›¡å¯èƒ½çš„è®“å–®å…ƒæ¸¬è©¦åªåŒ…å«ä¸€å€‹æ¦‚å¿µï¼Œä¸¦ä¸”ç›¡å¯èƒ½æ¸›å°‘ Assertã€‚

```python
class CrawlerTest(unittest.TestCase):
    def test_get_weather_forecast_time(self):
        forecast_table = get_taipei_forecast_weather_page()

        expected = get_weather_forecast_time(forecast_table)
        time_pattern = r'[\u4e00-\u9fa5] \d+/\d+ \d+:\d+~\d+/\d+ \d+:\d+'
        for time in expected:
            self.assertRegex(time, time_pattern)

    def test_get_weather_forecast_temperature(self):
        forecast_table = get_taipei_forecast_weather_page()

        expected = get_weather_forecast_temperature(forecast_table)
        temperature_pattern = r'\d+ ~ \d+'
        for temperature in expected:
            self.assertRegex(temperature, temperature_pattern)
```

ä½†æ˜¯ï¼Œå–®å…ƒæ¸¬è©¦æœ€é‡è¦çš„é‚„æ˜¯**å¯è®€æ€§**ï¼Œå¦‚æœä½ åœ¨å¯«å–®å…ƒæ¸¬è©¦çš„æ™‚å€™ï¼Œè¦ºå¾—æœ‰äº›æ¸¬è©¦ä¸­åŒ…å«æ•¸å€‹ Assert ä¹Ÿèƒ½å¤ æ¸…æ¥šè¡¨é”æ¸¬è©¦çš„æ„ç¾©ï¼Œé€™æ¨£åšä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

# **F.I.R.S.T Principle**

å¦‚æœä½ åœ¨ç¶²è·¯ä¸Šæœå°‹ã€ŒF.I.R.S.Tã€ï¼Œæ‡‰è©²å¯ä»¥æœå°‹åˆ°å…©ç¨®ä¸åŒçš„çµæœï¼Œä¸»è¦å·®åˆ¥åœ¨æ–¼æœ€å¾Œçš„ T æœ‰å…©ç¨®è§£é‡‹ (**T**horough / **T**imely)ï¼Œåœ¨é€™é‚Šå…©ç¨®è§£é‡‹éƒ½æ¡ç”¨ï¼Œå› ç‚ºå®ƒå€‘çš„è§£é‡‹éƒ½æœ‰å®ƒå€‘çš„é“ç†ã€‚

**F**ast**ï¼šæ¸¬è©¦åŸ·è¡Œçš„é€Ÿåº¦è¦è¶Šå¿«è¶Šå¥½**ï¼Œæ²’æœ‰ä¸€å€‹å·¥ç¨‹å¸«æœƒå–œæ­¡åŸ·è¡Œéœ€è¦ 20 ç§’çš„æ¸¬è©¦ï¼›è€Œä¸”ï¼Œé›–è‘—ç³»çµ±è¶Šä¾†è¶Šé¾å¤§ï¼Œæ¸¬è©¦è¶Šä¾†è¶Šå¤šï¼Œå¦‚æœæ¸¬è©¦åŸ·è¡Œé€Ÿåº¦å¤ å¿«ï¼Œå·¥ç¨‹å¸«æ›´èƒ½å¤ ä¸å­å…¶ç…©åœ°è·‘æ¸¬è©¦ã€‚

**I**ndependentï¼š**ä¸è¦è®“ä¸€å€‹æ¸¬è©¦é«˜åº¦ç›¸ä¾å…¶ä»–æ¸¬è©¦**ï¼Œå¦‚æœé€™éº¼åšçš„è©±ï¼Œä¸€å€‹æ¸¬è©¦ä¸€æ—¦ failureï¼Œå…¶ä»–ç›¸ä¾çš„æ¸¬è©¦ä¹Ÿæœƒ failureï¼Œå°‡ç„¡æ³•è¼•æ˜“åœ°ä½¿ç”¨æ¸¬è©¦æ‰¾å‡ºå•é¡Œã€‚

**R**epeatableï¼š**æ¸¬è©¦æ‡‰è©²è¦èƒ½å¤ åœ¨ä»»ä½•ç’°å¢ƒä¸‹éƒ½èƒ½å¤ æˆåŠŸåŸ·è¡Œ**ï¼Œä¸èƒ½å¤ å› ç‚ºç¶²è·¯ã€ä½œæ¥­ç³»çµ±ï¼Œç”šè‡³æ˜¯ä¸åŒçš„æ—¥æœŸè€Œå°è‡´æ¸¬è©¦å¤±æ•—ã€‚

**S**elf-validatingï¼š**æ¸¬è©¦æ‡‰è©²è¦è¼¸å‡º Booleanï¼Œè®“äººèƒ½å¤ åˆ†è¾¨å“ªäº›æ¸¬è©¦é€šéèˆ‡æ²’é€šé**ã€‚ä½œè€…åœ¨æ›¸ä¸­æåˆ°çš„é€™é»ï¼Œç¾ä»Šæœ‰è¨±å¤š IDE éƒ½å·²ç¶“èƒ½å¤ è¼”åŠ©åšåˆ°é€™ä¸€é»ï¼Œä¾‹å¦‚ vscode ä¾¿èƒ½å¤ é¡¯ç¤ºé€šéèˆ‡æ²’é€šéçš„å–®å…ƒæ¸¬è©¦ã€‚

![https://miro.medium.com/max/700/0*Y43UaT2UiL7ZtoRy.png](https://miro.medium.com/max/700/0*Y43UaT2UiL7ZtoRy.png)

å–è‡ªÂ [Python unit testing in Visual Studio Code](https://code.visualstudio.com/docs/python/unit-testing)

**T**horoughï¼š**æ¸¬è©¦ä¸æ‡‰è©²åªè¿½æ±‚æ¶µè“‹ç‡ 100%ï¼Œæ›´æ‡‰è©²è¿½æ±‚æ¸¬ç›¡æ‰€æœ‰çš„ä½¿ç”¨æƒ…å¢ƒ**ã€‚åŒ…æ‹¬ boundary valueã€æ•¸é‡é¾å¤§çš„è³‡æ–™é›†ã€è³‡å®‰ã€å¤§æ•¸ã€ä¾‹å¤–è™•ç†èˆ‡éé æœŸçš„å‡½æ•¸æ•¸é‡æˆ–è¼¸å…¥ã€‚

**T**imelyï¼š**æ¸¬è©¦æ‡‰è©²è¦åœ¨ç”¢å“ç¨‹å¼ä¹‹å‰æ’°å¯«**ï¼Œä¹Ÿå°±æ˜¯æ¸¬è©¦é©…å‹•é–‹ç™¼ (TDD)ï¼Œå¦‚æœèƒ½å¤ ç¶­æŒåœ¨ TDD çš„å¾ªç’°çµæŸå¾Œï¼ŒæŒçºŒåœ°é€šéå–®å…ƒæ¸¬è©¦ï¼Œæˆ‘å€‘å°±èƒ½ç¢ºä¿ç¨‹å¼ç¢¼çš„è¡Œç‚ºä¸€ç›´æ˜¯æ­£ç¢ºçš„ã€‚

# **å°çµ**

åœ¨é€™å€‹ç« ç¯€ï¼Œä½œè€…ä¸»è¦å¸Œæœ›æˆ‘å€‘èƒ½å¤ è®“å–®å…ƒæ¸¬è©¦çš„å¯è®€æ€§æ„ˆé«˜æ„ˆå¥½ï¼Œå› ç‚ºå–®å…ƒæ¸¬è©¦èˆ‡ç”¢å“ä¸€æ¨£é‡è¦ï¼Œå…©è€…æ˜¯äº’ç›¸ç‰½åˆ¶çš„å­˜åœ¨ã€‚

å†è€…ï¼Œç‚ºäº†æé«˜å–®å…ƒæ¸¬è©¦çš„å¯è®€æ€§ï¼Œæˆ‘å€‘å¯ä»¥æ’°å¯«ç‰¹å®šé ˜åŸŸçš„ç¨‹å¼èªè¨€ã€ç›¡é‡è®“å–®å…ƒæ¸¬è©¦åªåšä¸€ä»¶äº‹ï¼Œä»¥åŠç›¡é‡åªä½¿ç”¨ä¸€å€‹ assert ç­‰æŠ€å·§ã€‚

æœ€å¾Œï¼Œä½œè€…è®“æˆ‘å€‘çŸ¥é“ä»€éº¼æ˜¯ F.I.R.S.T åŸå‰‡ï¼ŒF.I.R.S.T è®“æˆ‘å€‘èƒ½å¤ äº•ç„¶æœ‰åºçš„æ’°å¯«æœ‰å“è³ªçš„å–®å…ƒæ¸¬è©¦ã€‚